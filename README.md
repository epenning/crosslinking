# AF2 & Cross-link Analysis

Source GitHub: https://github.com/epenning/crosslinking

Paper: https://www.biorxiv.org/content/10.1101/2022.08.25.505345v1

This repository contains analysis done for the above paper _"Does AlphaFold2 model proteinsâ€™ 
intracellular conformations? An experimental test using cross-linking mass spectrometry of 
endogenous ciliary proteins"_. It evaluates the distances between intra-protein cross-linked
residues when the protein structure has been predicted by AlphaFold. It also attempts to determine
which of these cross-links are intra or inter-domain, and uses ChimeraX to render snapshots of
structures with the cross-links overlayed.

## Files

### compare_crosslinks.ipynb

Python Notebook with all main analysis, including reading cross-link data and AF2 structures, 
thresholding AF structure distances between cross-linked residues, and comparing relationships with 
AF confidence measures, as well as watershed domain segmentation and initial figure creation.

### render_*_chimerax.py

ChimeraX scripts for automatically saving snapshots of a large number of structures. In addition to
snapshot renders, it also saves the logs. These are designed to be used in this way:

1. Open ChimeraX
2. Set ChimeraX working directory to this directory (crosslinking)
3. Run the Python script from within ChimeraX

* compare - Does `matchmaker` on two different PDBs, ex. relaxed and unrelaxed
  * Not super generalized, need to change lines 39 & 45 to different suffixes to compare others
* unrelaxed - Render all unrelaxed PDBs with cross-links drawn as lines, colored by satisfied vs not
  * Requires `XLs_intra_nonred.csv` file output from `compare_crosslinks.ipynb`
* ptm - Render all PTM PDBs similar to unrelaxed, but also with domains colored
  * Requires `watershed_labels.json` file output from `compare_crosslinks.ipynb`
  * Only has colors sampled for up to 9 domains in one protein

### check_unfinished_proteins.py

Quick utility script to see which of a list of protein IDs has a structure prediction or ChimeraX 
render or not.

### view_pae.py

Quick utility script to get the PAE from a .pkl file output from AF2 and look at its contents.

### same_residue_crosslinks.txt

These are the cross-links in my analysis which were connecting the same residue to itself, so they
were excluded from analysis.

### temp.txt

Scratch-file containg frequently referenced bash one-liners.

### intraXLstettsideas.pdf

Reference page with some ideas about what figures could look like.

### Union_XL1_XL2_PurifiedSECa-g_IEXcilia2inject2.3-newpeptidepos.csv

Original cross-link data source

### watershed_labels.json

Watershed labels as output from `compare_crosslinks.ipynb`, intended to be used by 
`render_ptm_chimerax.py`.

### XLs_intra_nonred.csv

Final dataframe of unique intra-protein cross-links for the proteins of interest output from 
`compare_crosslinks.ipynb`, intended to be used by`render_*_chimerax.py`.

### *.tar.gz

Compressed gzipped tar files of the folders of the same name, used for sharing (ex. GitHub).

## Directories

### chx

ChimeraX sessions, logs and images generated by the `render_*_chimerax.py` scripts.

* Images subdirectories contain the snapshots from these scripts for each category.
* VS_* subdirectories contain `render_compare_chimerax.py` outputs which compare the category for 
the containing directory against the one named by VS_*
* Also contains a ChimeraX session for EEF2 with the 5 model predictions all aligned

### example_xl_af_analysis

Simplified version of the initial analysis to compare cross-link data with AlphaFold predictions.

### figures

All WIP and final iterations of figures for this analysis. Inkscape was used.

### models

Structure model PDBs as produced by AF2 for all predictions used.

* `<protein-id>-unrelaxed_model_1.pdb` - unrelaxed default prediction
* `<protein-id>-unrelaxed_model_1_ptm.pdb` - unrelaxed PTM prediction
* `<protein-id>-relaxed_model_1.pdb` - relaxed prediction
* `<protein-id>-relaxed_model_1_ptm.pdb` - relaxed PTM prediction

### pae

Predicted Aligned Error .pkl files extracted from AF2 .pkl output for all PTM predictions used.

* `<protein-id>-pae_model_1_ptm.pdb` - unrelaxed PTM prediction

### rankings

`ranking_debug.json` files produced by AF2 for all unrelaxed non-PTM predictions used. Since only 
one model was run each time, these were only used to get the average pLDDT for each prediction.